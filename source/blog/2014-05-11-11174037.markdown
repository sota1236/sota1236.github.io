---
layout: post
title: ! '* Procmailを使ってメールを自動振り分けする'
published: true
date: 2014-05-11 17:40
comments: true
categories:
- サーバ設定
- 未分類
tags: []
keywords:
- サーバ設定
- 未分類
---
<p>[CNS Printer Status](http://printer.sota1235.net "CNS Printer Status")を作る際、CNSサーバ側でメールが来るたびにjsonを生成するスクリプトを書いた。</p>

<p>ただその時に厄介だったのが、Printerでないメールの中から毎回最新のPrinterメールを探しjsonを生成しなければならないことだった。</p>

<p>PHPで`scandir(hogehoge)`しようにも、cronでそんなん回して負荷かけて文句言われたらなぁー…と思って考えていたところ、ホームディレクトリに`procmaillog`という見慣れないファイルを発見した。</p>

<p>ggってみたところ、どうやらメールの振り分けを自動化するprocmailのlogファイルらしく、なぜ突然出てきたのかはともかくとしてこれを使わない手は無いと思い、さっそく設定してみた。</p>

<p>いじる前のファイル内容はこんな感じ(大人の事情で一部編集してます)。</p>

<pre class="brush: shell; gutter: true; first-line: 1; highlight: []; html-script: false">
PATH=/bin:/usr/bin:/usr/local/bin
MAILDIR=$HOME/Hogehoge
DEFAULT=$MAILDIR/
LOGFILE=$HOME/procmaillog
LOCKFILE=$HOME/.lockmail
:0H:
* ^X-Ironport: SPAM
$MAILDIR/.SPAM/
</pre>

<p>`:0H:`から振り分け条件の宣言らしい。それ以前は普通に変数宣言。</p>

<p>んで、`* ^X-Ironport: SPAM`が対象メールの設定、下の一行が振り分け先のフォルダですね。</p>

<p>なるほど、簡単っちゃ簡単。</p>

<p>ってことで以下の二行を追加。</p>

<pre class="brush: shell; gutter: true; first-line: 1; highlight: []; html-script: false">
* ^From.:*hogehoge@hoge.hoge.ac.jp
$MAILDIR/.HOGEHOGE/
</pre>

<p>この２行で"hogehoge@hoge.hoge.ac.jp"から来たメールを"$MAILDIR/.HOGEHOGE"フォルダーに移動させるという意味になる。</p>

<p>ちなみにFromの部分は正規表現なら何でもいいらしい。賢い。</p>

<p>これでThunderbirdいらずですな。</p>

<p>Thunderbirdの設定全部.procmailrcに移そうかな。スマホで見る時に振り分けられてたらテンションあがる。</p>

---
※この記事は WordPress に投稿した記事を変換したものです。一部不自然な表示があるかも知れません。ご了承ください。また、記事タイトル先頭の * は WordPress から移行した記事である印です。
